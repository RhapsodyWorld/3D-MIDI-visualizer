<!DOCTYPE html>
<html>
<head>
	<title>3D visualization</title>
	<link href="css/reset.css" type="text/css" rel="stylesheet">
	<link href="css/style.css" type="text/css" rel="stylesheet">
</head>
<body>

<div id="container"></div>

<script src="js/three.min.js"></script>
<script src="js/midi/stream.js"></script>
<script src="js/midi/midifile.js"></script>
<script src="js/midi/midiloader.js"></script>
<script src="js/classes/class.note.js"></script>
<script src="js/classes/class.vector.js"></script>
<script src="js/animator.js"></script>
<script src="js/physics.js"></script>
<script src="js/colors.js"></script>
<script src="js/midirenderer.js"></script>
<script>



var midiObject = new MidiLoader().load('midi/river.mid');
var animator;
var midiRenderer;

window.onload = function() {


window.map = new THREE.TextureLoader().load('images/glow.png');


	var player = document.createElement('audio');
	player.preload = true;
	player.src = "midi/river2.mp3";

	window.onMidiLoaded = function() {
		// Midi data
		console.log('Tracks: ', midiObject.getTracks());
		console.log('Ticks per beat: ', midiObject.getTicksPerBeat());
		console.log('BPM: ', midiObject.getBPM());

		// Initialize animator, physics and midirenderer
		animator = new Animator().init();
		window.Physics = new Physics().init();
		window.Colors = new Colors();
		midiRenderer = new MidiRenderer().init(midiObject, animator);

		// Start rendering
		player.oncanplaythrough = function() {
			midiRenderer.setPlayer(player);
			animate(0);
		}
	}

	var frame = 0;

	function animate(time) {
		// Request to be called again for next frame
		requestAnimationFrame(animate);

		// Render midi file and Three.js scene
		midiRenderer.render(time);
		animator.render(frame);

		frame++;
	}

}

</script>

</body>
</html>
